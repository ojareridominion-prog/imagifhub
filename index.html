<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IMAGIFHUB</title>
    
    <script src="https://unpkg.com/@telegram-apps/sdk@7.2.0/dist/core.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <style>
        /* --- CORE THEME VARIABLES --- */
        :root { 
            --bg: #000; 
            --text: #fff; 
            --bar: #1a1a1a; 
            --accent: #9c4dff; 
        }

        /* THEMES */
‚Äé.theme-white   {--bg:#fff; --text:#000; --bar:#eee;}
‚Äé.theme-black   {--bg:#000; --text:#fff; --bar:#111;}
‚Äé.theme-blood   {--bg:#2b0000; --text:#ffb3b3; --bar:#150000; --accent:#ff4d4d;}
‚Äé.theme-cyan    {--bg:#001f1f; --text:#00ffff; --bar:#001010;}
‚Äé.theme-sky     {--bg:#0a1a26; --text:#6fd3ff; --bar:#06111a;}
‚Äé.theme-orange  {--bg:#2a1400; --text:#ffb266; --bar:#1a0c00;}
‚Äé.theme-green   {--bg:#062013; --text:#5cff9d; --bar:#03140c;}
‚Äé.theme-violet  {--bg:#1a0026; --text:#f0b3ff; --bar:#100018;}

        body { 
            margin:0; 
            background:var(--bg); 
            color:var(--text); 
            font-family:sans-serif; 
            overflow:hidden; 
            transition: 0.3s;
        }
        
        /* --- TOP NAVIGATION --- */
        .top-bar { 
            position:fixed; 
            top:0; 
            width:100%; 
            height:56px; 
            background:var(--bar); 
            display:flex; 
            align-items:center; 
            z-index:100; 
            border-bottom:1px solid rgba(255,255,255,0.1); 
        }

        .cat-scroll { 
            display:flex; 
            overflow-x:auto; 
            padding:0 10px; 
            gap:10px; 
            scrollbar-width:none; 
        }

        .cat-scroll::-webkit-scrollbar { display:none; }

        .cat-btn { 
            background:rgba(255,255,255,0.1); 
            border:none; 
            color:inherit; 
            padding:6px 15px; 
            border-radius:20px; 
            white-space:nowrap; 
            font-size:14px; 
        }

        /* --- SWIPER FEED --- */
        #swiper { height:100vh; width:100vw; }
        .swiper-slide { position:relative; background:#111; display:flex; align-items:center; justify-content:center; }
        .swiper-slide img { width:100%; height:100%; object-fit:cover; }

        /* --- UI OVERLAYS --- */
        .overlay { 
            position:absolute; 
            bottom:0; 
            width:100%; 
            padding:40px 20px; 
            background:linear-gradient(transparent, rgba(0,0,0,0.8)); 
            pointer-events:none; 
        }

        .action-btns { 
            position:absolute; 
            right:15px; 
            bottom:100px; 
            display:flex; 
            flex-direction:column; 
            gap:20px; 
            pointer-events:all; 
        }

        .action-btns button { 
            background:none; 
            border:none; 
            color:#fff; 
            font-size:28px; 
            text-shadow: 0 2px 10px rgba(0,0,0,0.5); 
        }

        /* --- SIDE MENU --- */
        .menu-btn { 
            padding:15px; 
            font-size:20px; 
            cursor:pointer; 
            z-index:101; 
        }

        .side-menu { 
            position:fixed; 
            left:-280px; 
            top:0; 
            width:260px; 
            height:100%; 
            background:var(--bar); 
            transition:0.3s; 
            z-index:1000; 
            padding:20px; 
            box-shadow: 5px 0 15px rgba(0,0,0,0.5); 
        }

        .side-menu.open { left:0; }

        /* --- THEME CIRCLES --- */
        .theme-grid { 
            display:grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap:15px; 
            margin-top:20px; 
        }

        .theme-circle { 
            width:50px; 
            height:50px; 
            border-radius:50%; 
            overflow:hidden; 
            border:2px solid rgba(255,255,255,0.2); 
            display:flex; 
            cursor:pointer; 
        }

        .half-p { width:50%; height:100%; }
        .half-s { width:50%; height:100%; }

        .heart-pop { 
            position:absolute; 
            font-size:80px; 
            color:#f00; 
            animation: pop 0.6s ease-out forwards; 
            pointer-events:none; 
            z-index:10; 
        }

        @keyframes pop { 
            0% { transform:scale(0); opacity:0; } 
            50% { transform:scale(1.2); opacity:1; } 
            100% { transform:scale(1); opacity:0; } 
        }
    </style>
</head>

<body>
    <div class="top-bar">
        <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
        <div class="cat-scroll" id="catBar"></div>
        <div class="menu-btn" onclick="triggerSearch()">üîç</div>
    </div>

    <div class="side-menu" id="menuPanel">
        <h3>Styles</h3>
        <div class="theme-grid" id="themeBar"></div>
        <hr style="opacity:0.1; margin:20px 0;">
        <button onclick="alert('Join Premium for more!')" style="width:100%; padding:10px; background:var(--accent); border:none; color:#fff; border-radius:5px;">‚≠ê Upgrade</button>
    </div>

    <div class="swiper" id="swiper">
        <div class="swiper-wrapper" id="feed">
            <div class="swiper-slide">Loading Images...</div>
        </div>
    </div>

    <script>
        const webApp = window.Telegram.WebApp;
        webApp.expand();

        // --- CONFIG & STATE ---
        const API_URL = "https://your-render-app-url.com"; // UPDATE THIS
        
        // Restored Full Categories List
        const categories = [
            "All", "Nature", "Space", "City", "Superhero", "Supervillain", 
            "Robotic", "Anime", "Aesthetic", "Minimalist", "Cars", "Abstract", "Animals"
        ];

        const themes = [
            {id:'dark', p:'#000', s:'#fff'}, 
            {id:'white', p:'#fff', s:'#000'},
            {id:'blood', p:'#4a0e0e', s:'#f00'}, 
            {id:'neon', p:'#000', s:'#0ff'},
            {id:'midnight', p:'#020617', s:'#38bdf8'},
            {id:'sunset', p:'#2d142c', s:'#ff7e5f'},
            {id:'forest', p:'#052e16', s:'#4ade80'},
            {id:'cyberpunk', p:'#000', s:'#f0f'}
        ];

        let activeSwiper = null;
        let lastTap = 0;

        // --- CORE FUNCTIONS ---
        async function loadFeed(cat = "All", search = "") {
            const feed = document.getElementById('feed');
            feed.innerHTML = '<div class="swiper-slide">Fetching...</div>';
            
            try {
                const res = await fetch(`${API_URL}/media?category=${cat}&search=${search}`);
                const data = await res.json();
                
                if(data.length === 0) {
                    feed.innerHTML = '<div class="swiper-slide">No Wallpapers Found</div>';
                    return;
                }

                feed.innerHTML = data.map(img => `
                    <div class="swiper-slide" onclick="handleDoubleTap(event, ${img.id})">
                        <img src="${img.url}" loading="lazy">
                        <div class="overlay">
                            <b style="font-size:18px">@IMAGIFHUB</b><br>
                            <span style="opacity:0.8;">#${img.Keyword || img.category}</span>
                        </div>
                        <div class="action-btns">
                            <button id="like-${img.id}" onclick="like(${img.id})">‚ù§Ô∏è</button>
                            <button onclick="save(${img.id})">üìÇ</button>
                        </div>
                    </div>
                `).join('');
                
                if (activeSwiper) activeSwiper.destroy(true, true);
                activeSwiper = new Swiper('#swiper', { 
                    direction: 'vertical', 
                    loop: true,
                    threshold: 4
                });
            } catch(e) { 
                feed.innerHTML = '<div class="swiper-slide">Server Offline</div>'; 
            }
        }

        function toggleMenu() { 
            document.getElementById('menuPanel').classList.toggle('open'); 
        }
      
        function applyTheme(id) {
            document.body.className = id === 'dark' ? '' : 'theme-' + id;
            toggleMenu();
        }

        function triggerSearch() {
            let q = prompt("Search wallpapers:");
            if(q) loadFeed("All", q);
        }

        function handleDoubleTap(e, id) {
            const now = Date.now();
            if (now - lastTap < 300) {
                const heart = document.createElement('div');
                heart.className = 'heart-pop';
                heart.innerHTML = '‚ù§Ô∏è';
                e.currentTarget.appendChild(heart);
                setTimeout(() => heart.remove(), 600);
            }
            lastTap = now;
        }

        function like(id) { console.log("Liked:", id); }
        function save(id) { alert("Saved to Playlist!"); }

        // --- INITIALIZATION ---
        window.onload = () => {
            // 1. Render Categories
            document.getElementById('catBar').innerHTML = categories.map(c => 
                `<button class="cat-btn" onclick="loadFeed('${c}')">${c}</button>`
            ).join('');
            
            // 2. Render Theme Preview Circles
            document.getElementById('themeBar').innerHTML = themes.map(t => `
                <div class="theme-circle" onclick="applyTheme('${t.id}')">
                    <div class="half-p" style="background:${t.p}"></div>
                    <div class="half-s" style="background:${t.s}"></div>
                </div>
            `).join('');

            loadFeed("All");
        };
    </script>
</body>
</html>

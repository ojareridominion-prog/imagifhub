<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IMAGIFHUB</title>
    
    <script src="https://unpkg.com/@telegram-apps/sdk@7.2.0/dist/core.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <style>
        :root { 
            --bg: #000; 
            --text: #fff; 
            --bar: #1a1a1a; 
            --accent: #9c4dff; 
        }

        /* --- THEME DEFINITIONS --- */
        .theme-white { --bg: #fff; --text: #000; --bar: #f0f0f0; }
        .theme-blood { --bg: #4a0e0e; --text: #ffcfcf; --bar: #2a0505; --accent: #ff4d4d; }
        .theme-neon { --bg: #000; --text: #0ff; --bar: #001a1a; --accent: #0ff; }
        .theme-midnight { --bg: #020617; --text: #94a3b8; --bar: #0f172a; --accent: #38bdf8; }
        .theme-sunset { --bg: #2d142c; --text: #feb47b; --bar: #1a0a19; --accent: #ff7e5f; }
        .theme-forest { --bg: #052e16; --text: #dcfce7; --bar: #064e3b; --accent: #4ade80; }
        .theme-cyberpunk { --bg: #000; --text: #f0f; --bar: #1a001a; --accent: #ffee00; }

        body { 
            margin:0; 
            background:var(--bg); 
            color:var(--text); 
            font-family:system-ui, -apple-system, sans-serif; 
            overflow:hidden; 
            transition: background 0.3s, color 0.3s; 
        }
        
        /* --- UI COMPONENTS --- */
        .top-bar { 
            position:fixed; 
            top:0; 
            width:100%; 
            height:60px; 
            background:var(--bar); 
            display:flex; 
            align-items:center; 
            padding:0 15px; 
            z-index:100; 
            box-sizing:border-box;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .cat-bar { 
            position:fixed; 
            top:60px; 
            width:100%; 
            height:45px; 
            background:var(--bar); 
            display:flex; 
            overflow-x:auto; 
            white-space:nowrap; 
            padding:5px; 
            z-index:90; 
            scrollbar-width: none;
        }
        .cat-bar::-webkit-scrollbar { display:none; }
        .cat-btn { 
            background:rgba(255,255,255,0.1); 
            color:var(--text); 
            border:none; 
            padding:6px 15px; 
            margin:0 5px; 
            border-radius:20px; 
            font-size:13px;
        }

        .swiper { width:100vw; height:100vh; }
        .swiper-slide { position:relative; display:flex; justify-content:center; align-items:center; }
        .slide-img { width:100%; height:100%; object-fit:cover; }

        .overlay { 
            position:absolute; 
            bottom:0; 
            width:100%; 
            padding:40px 20px; 
            background:linear-gradient(transparent, rgba(0,0,0,0.8)); 
            color:#fff; 
            box-sizing:border-box;
        }

        /* --- MENU PANEL --- */
        .menu-panel { 
            position:fixed; 
            top:0; 
            left:-100%; 
            width:80%; 
            height:100%; 
            background:var(--bar); 
            z-index:1000; 
            transition:0.4s; 
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        .menu-panel.open { left:0; }
        .menu-link { 
            display:block; 
            padding:15px 25px; 
            color:var(--text); 
            text-decoration:none; 
            border-bottom:1px solid rgba(255,255,255,0.05); 
            font-weight: 500;
        }

        /* --- PREMIUM CARD --- */
        .premium-box {
            margin: 20px 15px;
            padding: 20px;
            background: linear-gradient(45deg, #9c4dff, #ff4d4d);
            border-radius: 15px;
            color: white;
            text-align: center;
        }
        .premium-btn {
            background: white;
            color: #9c4dff;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
            width: 100%;
        }

        /* --- THEME SELECTOR --- */
        .theme-row { 
            display:grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap:15px; 
            padding:15px 25px; 
        }
        .theme-circle { 
            width:45px; 
            height:45px; 
            border-radius:50%; 
            overflow:hidden; 
            border:2px solid rgba(255,255,255,0.2); 
            cursor:pointer;
        }
        .half-p { height:50%; width:100%; }
        .half-s { height:50%; width:100%; }

        /* --- ANIMATIONS --- */
        .heart-pop { 
            position:absolute; 
            font-size:80px; 
            animation: pop 0.6s ease-out forwards; 
            pointer-events:none; 
            z-index:200;
        }
        @keyframes pop { 
            0% { transform:scale(0); opacity:0; } 
            50% { transform:scale(1.2); opacity:1; } 
            100% { transform:scale(1); opacity:0; } 
        }
    </style>
</head>

<body>

    <div class="top-bar">
        <span onclick="toggleMenu()" style="font-size:24px; cursor:pointer;">‚ò∞</span>
        <b style="margin-left:20px; font-size:18px; letter-spacing:1px;">IMAGIFHUB</b>
        <span onclick="triggerSearch()" style="margin-left:auto; font-size:20px; cursor:pointer;">üîç</span>
    </div>

    <div class="cat-bar" id="catBar"></div>

    <div class="swiper" id="swiper">
        <div class="swiper-wrapper" id="feedContainer">
            <div class="swiper-slide">Loading Wallpapers...</div>
        </div>
    </div>

    <div id="menuPanel" class="menu-panel">
        <a href="#" class="menu-link" onclick="toggleMenu()" style="color:var(--accent); text-align:right;">‚úï Close</a>
        
        <div class="premium-box">
            <div style="font-weight: bold; font-size: 18px;">IMAGIF PREMIUM ‚≠ê</div>
            <div style="font-size: 12px; opacity: 0.9; margin-top: 5px;">Unlock 4K Downloads & Exclusive AI Themes</div>
            <button class="premium-btn" onclick="alert('Premium Features Coming Soon!')">UPGRADE NOW</button>
        </div>

        <a href="#" class="menu-link">üìÇ My Playlist</a>
        <a href="https://t.me/imagifhub" target="_blank" class="menu-link">üì¢ Join Official Channel</a> 
        
        <div style="padding:20px 25px 5px; font-size:11px; opacity:0.5; letter-spacing: 1px; font-weight: bold;">SELECT THEME</div>
        <div class="theme-row" id="themeBar"></div>
        
        <div style="padding: 40px 20px; font-size: 10px; opacity: 0.3; text-align: center;">
            IMAGIFHUB v2.2.0<br>Designed for Telegram
        </div>
    </div>

    <script>
        const API_URL = "https://imagifhub.onrender.com"; //
        const categories = ["All", "Nature", "Space", "City", "Superhero", "Anime", "Minimal", "Car"];
        
        const themes = [
            {id:'dark', p:'#000', s:'#fff'}, 
            {id:'white', p:'#fff', s:'#000'},
            {id:'blood', p:'#4a0e0e', s:'#f00'}, 
            {id:'neon', p:'#000', s:'#0ff'},
            {id:'midnight', p:'#020617', s:'#38bdf8'},
            {id:'sunset', p:'#2d142c', s:'#ff7e5f'},
            {id:'forest', p:'#052e16', s:'#4ade80'},
            {id:'cyberpunk', p:'#000', s:'#f0f'}
        ];

        let activeSwiper = null;
        let lastTap = 0;
        let isPremium = false;

        async function loadFeed(cat, search = "") {
            const feed = document.getElementById('feedContainer');
            try {
                const res = await fetch(`${API_URL}/media?category=${cat}&search=${search}`);
                const data = await res.json();
                
                if (data.length === 0) {
                    feed.innerHTML = '<div class="swiper-slide"><h3>No Wallpapers Found</h3></div>';
                    return;
                }

                feed.innerHTML = data.map(img => `
                    <div class="swiper-slide" onclick="handleDoubleTap(event, ${img.id})">
                        <img class="slide-img" src="${img.url}" loading="lazy">
                        <div class="overlay">
                            <b style="font-size:18px">@IMAGIFHUB</b><br>
                            <span style="opacity:0.8;">#${img.Keyword || img.category}</span>
                        </div>
                        <div style="position:absolute; right:20px; bottom:100px; display:flex; flex-direction:column; gap:25px; z-index:10;">
                            <button id="like-${img.id}" onclick="like(${img.id})" style="background:none; border:none; color:#fff; font-size:28px; cursor:pointer; transition:0.2s;">‚ù§Ô∏è</button>
                            <button onclick="save(${img.id})" style="background:none; border:none; color:#fff; font-size:28px; cursor:pointer;">üìÇ</button>
                        </div>
                    </div>
                `).join('');
                
                if (activeSwiper) activeSwiper.destroy(true, true);
                activeSwiper = new Swiper('#swiper', { 
                    direction: 'vertical', 
                    mousewheel: true,
                    threshold: 5
                });
            } catch(e) { 
                feed.innerHTML = '<div class="swiper-slide"><h3>Connection Error</h3><p>Server is offline.</p></div>'; 
            }
        }

        function toggleMenu() { 
            document.getElementById('menuPanel').classList.toggle('open'); 
        }
        
        function applyTheme(id) {
            // Logic for locking premium themes can be added here
            document.body.className = id === 'dark' ? '' : 'theme-' + id;
            toggleMenu();
        }

        function triggerSearch() {
            let q = prompt("Search wallpapers (e.g. 'Batman'):");
            if(q) loadFeed("All", q);
        }

        function handleDoubleTap(e, id) {
            const now = Date.now();
            if (now - lastTap < 300) {
                const heart = document.createElement('div');
                heart.className = 'heart-pop';
                heart.innerHTML = '‚ù§Ô∏è';
                e.currentTarget.appendChild(heart);
                setTimeout(() => heart.remove(), 600);
                like(id);
            }
            lastTap = now;
        }

        function like(id) { 
            const btn = document.getElementById(`like-${id}`);
            if(btn) btn.style.transform = "scale(1.5)";
            setTimeout(() => { if(btn) btn.style.transform = "scale(1)"; }, 200);
        }

        function save(id) { alert("Added to your Playlist!"); }

        // Initialization
        window.onload = () => {
            // Render Categories
            document.getElementById('catBar').innerHTML = categories.map(c => 
                `<button class="cat-btn" onclick="loadFeed('${c}')">${c}</button>`
            ).join('');
            
            // Render Themes
            document.getElementById('themeBar').innerHTML = themes.map(t => `
                <div class="theme-circle" onclick="applyTheme('${t.id}')">
                    <div class="half-p" style="background:${t.p}"></div>
                    <div class="half-s" style="background:${t.s}"></div>
                </div>
            `).join('');

            loadFeed("All");
        };
    </script>
</body>
</html>

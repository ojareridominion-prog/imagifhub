<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Playlist</title>
    <script src="https://telegram.org/js/telegram-web-script.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; padding: 15px; margin: 0; }
        .header { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #222; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .card { position: relative; border-radius: 12px; overflow: hidden; height: 280px; background: #111; }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .del-btn { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.6); border: none; color: #fff; border-radius: 50%; width: 30px; height: 30px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .back { background: none; border: 1px solid #444; color: #fff; padding: 8px 15px; border-radius: 8px; margin-right: 15px; cursor: pointer; text-decoration: none; font-size: 14px;}
        .empty-msg { grid-column: 1 / -1; text-align: center; color: #888; margin-top: 50px; font-size: 14px; }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="back">← Back</a>
        <h2 style="margin:0; font-size: 18px;">Saved Wallpapers</h2>
    </div>

    <div class="grid" id="grid">
        <p style="grid-column: 1/-1; text-align: center; color: #666;">Loading your playlist...</p>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        const API_URL = "https://imagifhub.onrender.com";
        
        // --- 2. GET USER ID (CRITICAL FIX) ---
        // This line was likely missing in your previous file
        const USER_ID = window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 999;

        // --- 3. LOAD FUNCTION ---
        async function load() {
            const container = document.getElementById('grid');
            
            try {
                // Fetch playlist using the specific USER_ID
                const response = await fetch(`${API_URL}/playlist/${USER_ID}`);
                const data = await response.json();

                // If empty or no data
                if (!data || data.length === 0) {
                    container.innerHTML = "<div class='empty-msg'>No wallpapers saved yet.<br>Go back and add some! ❤️</div>";
                    return;
                }

                // Render images
                container.innerHTML = data.map(img => `
                    <div class="card" id="card-${img.id}">
                        <img src="${img.url}" onclick="window.open('${img.url}', '_blank')">
                        <button class="del-btn" onclick="removeFromPlaylist(${img.id})">×</button>
                    </div>
                `).join('');

            } catch (e) {
                console.error(e);
                container.innerHTML = "<p style='grid-column: 1/-1; text-align: center; color: #ff4d4d;'>Error loading playlist.<br>Check your connection.</p>";
            }
        }

        // --- 4. REMOVE FUNCTION ---
        async function removeFromPlaylist(mediaId) {
            if(!confirm("Remove from playlist?")) return;
            
            const card = document.getElementById(`card-${mediaId}`);
            card.style.opacity = '0.5'; // Visual feedback

            try {
                const res = await fetch(`${API_URL}/playlist/remove/${USER_ID}/${mediaId}`, { method: 'DELETE' });
                const result = await res.json();
                
                if(result.status === "removed") {
                    card.remove();
                    // Check if grid is empty now
                    if(document.querySelectorAll('.card').length === 0) {
                         document.getElementById('grid').innerHTML = "<div class='empty-msg'>No wallpapers saved yet.</div>";
                    }
                } else {
                    alert("Could not remove item.");
                    card.style.opacity = '1';
                }
            } catch(e) { 
                console.error(e);
                alert("Connection failed.");
                card.style.opacity = '1';
            }
        }

        // Start loading immediately
        load();
    </script>
</body>
</html>
